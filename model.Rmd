---
title: "Model"
author: "Sreya Sudireddy"
date: "11/18/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(naniar)
library(lubridate)
library(tidyverse)
library(janitor)
library(plm)
```

```{r}
#Reading in covid data

covid <- readRDS("coviddata.RDS") %>%
  mutate(positiveIncrease = replace(positiveIncrease, which(positiveIncrease < 0), 0))
  #mutate(totalTestResultsIncrease = replace(totalTestResultsIncrease, which(totalTestResultsIncrease < 0), 0))

# Reading in social distancing data
social_distancing_nov <- readRDS("socialdistancing_11_15.RDS")
  #replace_with_na_all(condition = ~.x == "-") %>%
 # mutate(date = "2020-11-11") %>%
  # mutate(date = as.Date(date))
  
covid_nov <- covid %>%
  slice(1:612)

covid_oct <- covid %>%
  slice(612:2703)

social_distancing_oct <- readRDS("socialdistancing.RDS")
 # replace_with_na_all(condition = ~.x == "-") %>%
 # mutate(date = "2020-10-20") %>%
  # mutate(date = as.Date(date))

#social_distancing_final <- bind_rows(social_distancing_nov, social_distancing_oct)

oct_dta <- full_join(covid_oct, social_distancing_oct, by = c("state" = "Location"))
nov_dta <- full_join(covid_nov, social_distancing_nov, by = c("state" = "Location"))
#merging data for model
model_dta <- bind_rows(nov_dta, oct_dta)

```


```{r}
model_mask_dta <- model_dta %>%
  clean_names() %>%
  mutate(face_covering_requirement = case_when(face_covering_requirement == "-" ~ 0,
                                            face_covering_requirement == "Required for Certain Employees" ~ 1,
                                          face_covering_requirement == "Allows Local Officials to Require for General Public" ~ 2,
                                          face_covering_requirement == "Allows Local Officals to Require for General Public" ~ 2,
                                          face_covering_requirement == "Required for Certain Employees; Allows Local Officials to Require for General Public" ~ 2,
                                            face_covering_requirement == "Required for Certain Employees; Required for General Public" ~ 3,
                                          face_covering_requirement == "Required for General Public" ~ 3)) %>%
  mutate(face_covering_requirement = as.factor(face_covering_requirement)) %>%
  select(date, state, cases, deaths, positive_increase, total_test_results, total_test_results_increase, face_covering_requirement)

```

```{r}
mask_model_lm <- lm(positive_increase ~ face_covering_requirement,
                    data = model_mask_dta)


mask_model_plm <- plm(positive_increase ~ face_covering_requirement,
                  index = c("state", "date"),
                 data = model_mask_dta)
summary(mask_model_plm)
```


